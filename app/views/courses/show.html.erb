<% content_for :title do %>
  <%= @course.title %>
<% end %>
<div class="d-flex gap-2 mb-3">
  <%= link_to 'Courses', courses_path %> /
  <%= link_to course_path(@course) do %>
    <i class="fa-solid fa-graduation-cap"></i>
    <%= @course.title %>
  <% end %>
</div>
<div class="row">
  <div class="col-lg-8 order-1 order-lg-1">
    <div class="d-grid gap-2">
      <div class="container-fluid text-lg-left p-4 bg-light">
        <h3 class="mb-4">
          <i class="fa-solid fa-graduation-cap"></i>
          <%= link_to @course.title, @course %>
        </h3>
        <div class="mt-4 mx-auto">
          <i class="fa-solid fa-clock"></i>
          <%= @course.updated_at.strftime('%b-%Y') %>
        </div>
        <div class="mx-auto">
          <i class="fa-solid fa-earth-africa"></i>
          <%= @course.language %>
        </div>
        <div class="mx-auto">
          <i class="fa-solid fa-signal"></i>
          <%= @course.level %>
        </div>
        <div class="mt-3 mx-auto">
          <%= @course.description %>
        </div>
      </div>
      <h5 class="mt-3">
        <i class="fa-solid fa-list-check"></i>
        <%= pluralize(@course.lessons_count, 'Lesson') %>
        <% if current_user && !@course.owned_by?(current_user) %>
          <div class="float-end">
            <i class="fa-solid fa-spinner"></i>
            <%= number_to_percentage(@course.progress(current_user), precision: 0) %>
          </div>
        <% end %>
      </h5>
      <ul class="list-group <%= 'jquery-ui-sortable' if policy(@course).edit? %>">
        <% @lessons.each do |lesson| %>
          <%= content_tag 'div', id: "lesson-#{lesson.id}", data: { model_name: lesson.class.name.underscore, update_url: course_lesson_sort_path(@course, lesson) } do %>
            <li class="list-group-item">
              <%= render partial: 'lessons/lesson_preview', locals: { lesson: lesson } %>
            </li>
          <% end %>
        <% end %>
      </ul>
      <h5 class="mt-3">
        <i class="fa-solid fa-comments"></i>
        <%= pluralize(@recent_reviews.count, 'Review') %>
      </h5>
      <% @recent_reviews.each do |enrollment| %>
        <%= render "enrollments/enrollment", enrollment: enrollment %>
      <% end %>
    </div>
    <div class="row mt-4">
      <h5>
        <i class="fa-solid fa-rocket"></i>
        Similar courses
      </h5>
      <div class="row row-cols-1 row-cols-md-3 g4">
        <% @similar_courses.each do |course| %>
          <% if @course.tags.pluck(:id).intersection(course.tags.pluck(:id)).count.positive? %>
            <div class="col">
              <%= render partial: 'course', locals: { course: course } %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="col-lg-4 order-0 order-lg-1 mb-3">
    <div class="sticky-top">
      <%= render partial: 'course', locals: { course: @course } %>
    </div>
  </div>
</div>
