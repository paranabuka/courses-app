<div class="card">
  <div class="card-header">
    <i class="fa-solid fa-graduation-cap"></i>
    <%= link_to course.title, course %>
  </div>
  <div class="card-body">
    <%= course.short_description %>
  </div>
  <div class="card-footer text-center">
    <%= enroll_in(course) %>
    <div class="row"></div>
    <%= review(course) %>
  </div>
  <div class="card-footer d-flex">
    <div class="flex-grow-1">
      <i class="text-warning fa-solid fa-star"></i>
      <b>
        <%= course.average_rating %>
      </b>
      (
      <i class="fa-solid fa-user-graduate"></i>
      <%= course.enrollments_count %>
      )
      <i class="fa-solid fa-list-check"></i>
      <%= pluralize(course.lessons_count, 'lesson') %>
    </div>
    <div>
      <i class="fa-solid fa-chalkboard-user"></i>
      <%= link_to course.user.username, user_path(course.user) %>
    </div>
  </div>
  <% if current_user %>
    <% if policy(course).owner? %>
      <div class="card-footer">
        <%= link_to 'Add lesson', new_course_lesson_path(course, @lesson), class: 'btn btn-primary btn-sm text-light' %>
        <%= link_to 'Edit', edit_course_path(course), class: 'btn btn-sm btn-warning text-dark' %>
        <%= link_to 'Destroy', course, class: 'btn btn-sm btn-danger text-light', method: :delete, data: { confirm: 'Are you sure?' } if policy(course).destroy? %>
        <%= link_to analytics_course_path(course), class: 'btn btn-sm btn-info text-light' do %>
          <div class="fa-solid fa-chart-area"></div>
          Analytics
        <% end %>
      </div>
    <% end %>
    <% if policy(current_user).admin? || policy(course).owner? %>
      <div class="card-footer">
        <% if course.published %>
          <span class="badge bg-success">Published</span>
        <% else %>
          <span class="badge bg-danger">Not published</span>
        <% end %>
        <% if course.approved %>
          <span class="badge bg-success">Approved</span>
        <% else %>
          <span class="badge bg-danger">Not approved</span>
        <% end %>
      </div>
      <% if policy(course).approve? %>
        <div class="card-footer">
          <% if course.approved %>
            <%= link_to 'Reject', reject_course_path(course), method: :patch, class: 'btn btn-sm btn-danger' %>
          <% else %>
            <%= link_to 'Approve', approve_course_path(course), method: :patch, class: 'btn btn-sm btn-success' %>
          <% end %>
        </div>
      <% end %>
    <% end %>
  <% end %>
</div>
